<nz-layout class="layout">
  <nz-sider
    nzwidth="236px"
    class="ant-layout-sider menu-sidebar hide-for-small hide-for-medium show-for-large ant-layout-sider-dark"
    style="flex: 0 0 236px; max-width: 236px; min-width: 236px; width: 236px;"
  >
    <div class="logo">
      <img
        src="../../../assets/images/logo/logo.png"
        alt="Logo"
        [routerLink]="'/dashboard'"
      />
    </div>

    <div class="custom-dark-menu">
      <ul nz-menu nzTheme="dark" nzMode="inline">
        <li nz-submenu nzTitle="Quản lý bãi xe">
          <ul>
            <li nz-menu-item [routerLink]="'/dashboard'">
              <span nz-icon nzType="home" nzTheme="fill"></span>
              <span>Trang chủ</span>
            </li>
            <li nz-submenu nzTitle="Báo cáo" nzIcon="line-chart">
              <ul>
                <li nz-menu-item [routerLink]="'/entry-logs'">Xe vào bãi</li>
                <li nz-menu-item [routerLink]="'/exit-logs'">Xe đã ra</li>
                <li nz-menu-item [routerLink]="'/warning-events'">Sự kiện cảnh báo</li>
                <li nz-menu-item [routerLink]="'/revenue-reports'">Báo cáo doanh thu</li>
              </ul>
            </li>
          </ul>
        </li>

        <li nz-submenu nzTitle="Quản lý khách hàng">
          <ul>
            <li nz-menu-item [routerLink]="'/customer-groups'">
              <span nz-icon nzType="usergroup-add" nzTheme="outline"></span>
              <span>Nhóm khách hàng</span>
            </li>
            <li nz-menu-item [routerLink]="'/customers'">
              <span nz-icon nzType="user-add" nzTheme="outline"></span>
              <span>Khách hàng</span>
            </li>
          </ul>
        </li>

        <li nz-submenu nzTitle="Quản lý thẻ">
          <ul>
            <li nz-menu-item [routerLink]="'/card-groups'">
              <span nz-icon nzType="credit-card" nzTheme="fill"></span>
              <span>Nhóm thẻ</span>
            </li>
            <li nz-menu-item [routerLink]="'/cards'">
              <span nz-icon nzType="idcard" nzTheme="fill"></span>
              <span>Thẻ</span>
            </li>
          </ul>
        </li>

        <li nz-submenu nzTitle="Quản lý thiết bị">
          <ul>
            <li nz-menu-item [routerLink]="'/gates'">
              <span nz-icon nzType="bank" nzTheme="fill"></span>
              <span>Cổng</span>
            </li>
            <li nz-menu-item [routerLink]="'/computers'">
              <span nz-icon nzType="laptop" nzTheme="outline"></span>
              <span>Máy tính</span>
            </li>
            <li nz-menu-item [routerLink]="'/cameras'">
              <span nz-icon nzType="camera" nzTheme="fill"></span>
              <span>Camera</span>
            </li>
            <li nz-menu-item [routerLink]="'/control_units'">
              <span nz-icon nzType="control" nzTheme="fill"></span>
              <span>Bộ điều khiển</span>
            </li>
            <li nz-menu-item [routerLink]="'/lanes'">
              <span nz-icon nzType="sliders" nzTheme="fill"></span>
              <span>Làn</span>
            </li>
            <li nz-menu-item [routerLink]="'/leds'">
              <span nz-icon nzType="bulb" nzTheme="fill"></span>
              <span>Led</span>
            </li>
          </ul>
        </li>

        <li nz-submenu nzTitle="Quản lý tài khoản">
          <ul>
            <li nz-menu-item [routerLink]="'/role-permissions'">
              <span nz-icon nzType="safety-certificate" nzTheme="fill"></span>
              <span>Vai trò, quyền hạn</span>
            </li>
            <li nz-menu-item [routerLink]="'/users'">
              <span nz-icon nzType="user" nzTheme="outline"></span>
              <span>Người dùng</span>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </nz-sider>

  <nz-layout class="ant-layout right-layout">
    <nz-header class="ant-layout-header">
      <div>
        <button nz-button nzType="primary" style="border-radius: 8px; border-color: #919EAB14; background-color: #919EAB14; color: #637381; margin-left: 17px;">
          <span nz-icon nzType="search"></span>
          <span>Tìm kiếm thư mục</span>
        </button>
      </div>

      <div>
        <span
          style="margin-right: 15px;"
          nz-dropdown
          [nzDropdownMenu]="userMenu"
          nzplacement="bottomRight"
        >
          <nz-avatar
            [nzText]="displayName.charAt(0).toUpperCase()"
            style="margin-right: 3px"
          ></nz-avatar>
          {{ displayName }}
          <span nz-icon nzType="down"></span>
        </span>

        <nz-dropdown-menu #userMenu="nzDropdownMenu">
          <div
            style="
              width: 220px;
              padding: 20px;
              border-radius: 16px;
              background: white;
              box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
              margin-top: 20px;
            "
          >
            <div
              style="
                font-weight: 500;
                margin-bottom: 12px;
                border-bottom: 1px solid #d5d4d4;
                padding-bottom: 8px;
              "
            >
              Tài khoản người dùng
            </div>

            <div
              style="
                display: flex;
                align-items: center;
                cursor: pointer;
                margin-bottom: 16px;
                padding: 12px;
              "
              (click)="openDrawer()"
            >
              <nz-avatar
                nzIcon="user"
                nzShape="square"
                style="margin-right: 12px; border-radius: 8px"
              ></nz-avatar>
              <div>
                <div style="font-weight: 300; font-size: 13px;">
                  Tài khoản của tôi
                </div>
                <div style="font-size: 11px; color: #999;">
                  Thiết lập tài khoản
                </div>
              </div>
            </div>

            <div style="display: flex; justify-content: center;">
              <button
                nz-button
                (click)="logout()"
                style="
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  gap: 6px;
                  border-radius: 8px;
                  margin: 0 auto;
                  width: 85%;
                "
              >
                <span nz-icon style="color: #fa7300;">
                  <i nz-icon nzType="logout"></i>
                </span>
                <span style="color: #38393a; font-weight: 500;">
                  Đăng xuất
                </span>
              </button>
            </div>
          </div>
        </nz-dropdown-menu>
      </div>
    </nz-header>

    <nz-content>
      <router-outlet></router-outlet>
    </nz-content>
  </nz-layout>
</nz-layout>

<nz-drawer
  [nzVisible]="isDrawerVisible"
  nzTitle="Tài khoản người dùng"
  nzPlacement="right"
  [nzClosable]="true"
  (nzOnClose)="closeDrawer()"
>
  <ng-container *nzDrawerContent>
    <form [formGroup]="changePasswordForm" nz-form nzLayout="vertical">
      <nz-form-item>
        <nz-form-label nzFor="username">Tài khoản</nz-form-label>
        <nz-form-control>
          <input
            nz-input
            id="username"
            [disabled]="true"
            [value]="displayName"
            style="border-radius: 8px;"
          />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzRequired]="true" nzFor="currentPassword">Mật khẩu hiện tại</nz-form-label>
        <nz-form-control>
          <div style="position: relative;">
            <input
              nz-input
              id="currentPassword"
              formControlName="currentPassword"
              [type]="showCurrentPassword ? 'text' : 'password'"
            />
            <span
              class="password-toggle-icon"
              nz-icon
              [nzType]="showCurrentPassword ? 'eye-invisible' : 'eye'"
              (click)="showCurrentPassword = !showCurrentPassword"
            ></span>
          </div>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzRequired]="true" nzFor="newPassword">Mật khẩu mới</nz-form-label>
        <nz-form-control>
          <div style="position: relative;">
            <input
              nz-input
              id="newPassword"
              formControlName="newPassword"
              [type]="showNewPassword ? 'text' : 'password'"
            />
            <span
              class="password-toggle-icon"
              nz-icon
              [nzType]="showNewPassword ? 'eye-invisible' : 'eye'"
              (click)="showNewPassword = !showNewPassword"
            ></span>
          </div>

          <div *ngIf="changePasswordForm.get('newPassword')?.hasError('minlength')" 
               style="color: red; font-size: 12px; margin-top: 4px;">
            Mật khẩu phải có ít nhất 6 ký tự
          </div>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzRequired]="true" nzFor="confirmPassword">Xác nhận mật khẩu mới</nz-form-label>
        <nz-form-control>
          <div style="position: relative;">
            <input
              nz-input
              id="confirmPassword"
              formControlName="confirmPassword"
              [type]="showConfirmPassword ? 'text' : 'password'"
            />
            <span
              class="password-toggle-icon"
              nz-icon
              [nzType]="showConfirmPassword ? 'eye-invisible' : 'eye'"
              (click)="showConfirmPassword = !showConfirmPassword"
            ></span>
          </div>
        </nz-form-control>
      </nz-form-item>

      <div style="padding: 24px 0; margin-top: 24px; border-top: 1px solid #f0f0f0;">
        <nz-form-item>
          <nz-form-control>
            <button
              nz-button
              [nzType]="changePasswordForm.valid && checkPasswordMatch() ? 'primary' : 'default'"
              [disabled]="!changePasswordForm.valid || !checkPasswordMatch"
              (click)="changePassword()"
              style="width: auto; float: right"
            >
              <i nz-icon nzType="check"></i>
              Đổi mật khẩu
            </button>
          </nz-form-control>
        </nz-form-item>
      </div>
    </form>
  </ng-container>
</nz-drawer>
